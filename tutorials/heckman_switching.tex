\chapter{An introduction to sample selection model and switching regression}

\section{Sample Selectivity}

The problem of sample selection arises when the sample is a
non-random selection of potential observations.  This occurs when
the observed data is systematically different from the population
of interest.

Suppose that $y_t^0$ and $z_t^0$ are two latent variables,
generated by the bivariate process

\begin{equation}
\begin{bmatrix}
y_t^0 \\ z_t^0
\end{bmatrix}
=\begin{bmatrix} {\bf X}_t \beta \\ {\bf W}_t \gamma
\end{bmatrix}+
\begin{bmatrix} u_t \\ v_t
\end{bmatrix}, \
\begin{bmatrix} u_t \\ v_t
\end{bmatrix} \sim NID({\bf 0},
\begin{bmatrix} \sigma^2 & \rho  \\ \rho  & 1
\end{bmatrix})
\end{equation}

We observe $y_t$ and $z_t$:
\begin{eqnarray}
 y_t & = & y_t^0 \ \mbox{if} \ z_t^0 > 0;  \ y_t \ \mbox{unobservable otherwise}; \nonumber \\
 z_t & = & 1  \ \mbox{if} \ z_t^0 > 0; \ z_t=0 \ \mbox{otherwise}.
\end{eqnarray}

There are two types of observations, ones we observe $y_t=y_t^0$
and $z_t=1$, along with both $\bf X_t$ and $\bf W_t$, and ones we
observe only $z_t=0$ and $\bf W_t$.

Each observation contributes to the likelihood function by
\begin{equation}
I(z_t=0)\mbox{Pr}(z_t=0)+I(z_t=1)\mbox{Pr}(z_t=1)f(y_t^0 | z_t=1),
\end{equation}

Under the normality assumption,
\begin{equation}
u_t=\rho v_t+e_t
\end{equation}
where $e_t$ is independent of $v_t \sim N(0,1)$.  A useful fact
about the standard normal distribution is that
\begin{equation}
{\rm E} (v_t | v_t>-x)=\lambda (x) =\frac{\phi(x)}{\Phi(x)}
\end{equation}
and the function $\lambda(x)$ is called the inverse Mills ratio.
Sometimes it's called nonselection hazard.  It is really a hazard of
units not been selected.  

For example, if we are interested in the women's wage problem.  What
we observe is women in the labor force.  We want to draw an inference
on women in general (in labor force or not).  The inverse mills ratio
is really the hazard of NOT being selected (not in labor force in this
example).  

The loglikelihood function can be shown to be
\begin{equation}
\sum_{z_t=0} \log \Phi(-{\bf W}_t \gamma)+\sum_{z_t=1}
\log(\frac{1}{\sigma} \phi ((y_t - {\bf X}_t \beta)/\sigma)) +
\sum_{z_t=1} \log \Phi (\frac{{\bf W}_t \gamma+\rho (y_t-{\bf X}_t
\beta)/\sigma}{(1-\rho^2)^{1/2}})
\end{equation}

So this model can be estimated by MLE.

However, it is popular to use Heckman's two-step method.

Heckman's method is based on the fact that the original latent
model can be rewritten as
\begin{equation}
y_t={\bf X}_t \beta + \rho v_t +e_t
\end{equation}

Here the error term $u_t$ is divided into two partes, one
perfectly correlated with $v_t$, and one independent of $v_t$.

In the first step, an ordinary probit model is used to obtain
consistent estimates $\hat \gamma$ of the parameters of the
selection equation.

In the second step, the unobserved $v_t$ is replaced by the
selectivity regressor $\frac{\phi({\bf W}_t \hat
\gamma)}{\Phi({\bf W}_t \hat \gamma)}$.

Therefore, the regression becomes
\begin{equation}
y_t={\bf X}_t \beta + \rho \frac{\phi({\bf W}_t \hat
\gamma)}{\Phi({\bf W}_t \hat \gamma)} + e_t
\end{equation}

Or,
\begin{equation}
y_t={\bf X}_t \beta + \rho \hat \lambda_t + e_t
\end{equation}

\subsubsection{Switching Regression (Treatment-Effects Model)}

The treatment effect model estimates the effect of an endogenous
binary treatment$z_t$ (treatment, program participation, etc.) on a
continuous, fully-observed variable,$y_t$, conditional on the
independent variables $x_t$ and $w_t$.

Suppose $z_t^0$ is a latent variable.

\begin{equation}
\begin{bmatrix}
y_t \\ z_t^0
\end{bmatrix}
=\begin{bmatrix} {\bf X}_t \beta \\ {\bf W}_t \gamma
\end{bmatrix}+ \delta \begin{bmatrix} {z_t} \\ 0
\end{bmatrix} +
\begin{bmatrix} u_t \\ v_t
\end{bmatrix}, \
\begin{bmatrix} u_t \\ v_t
\end{bmatrix} \sim NID({\bf 0},
\begin{bmatrix} \sigma^2 & \rho  \\ \rho  & 1
\end{bmatrix})
\end{equation}

We observe $y_t$ and $z_t$:
\begin{eqnarray}
  z_t  =  1  \ \mbox{if} \ z_t^0 > 0; \ z_t=0 \ \mbox{otherwise}.
\end{eqnarray}

Notice that the only difference between the switching regression and selection model is that we observe $y_t$ when $z_t=0$ and $z_t=1$.  It's not a selection, but a regime switching.

Both Stata (treatreg) and SAS (qlim) can estimate the switching regression.  The default is by MLE.
